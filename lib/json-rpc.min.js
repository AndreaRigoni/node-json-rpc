var util=require("util");var through=require("through");var jsonrpc={errors:{"-32700":"Parse error","-32600":"Invalid Request","-32601":"Method not found","-32602":"Invalid params","-32603":"Internal error","-32000":"Server error"},request:function(f,d,c,b){var a=util.format('{"jsonrpc":"2.0","method":"%s"',f);
if(!d&&!c){return a+"}";}else{if(!c){return util.format('%s,"id":%s',a,d);}else{if(!d){return util.format('%s,"params":%s}',a,b?c:JSON.stringify(c));}else{return util.format('%s,"params":%s,"id":%s}',a,b?c:JSON.stringify(c),d);
}}}},response:function(c,a,b){if(a===undefined){a=null;}return util.format('{"jsonrpc":"2.0","id":%s,"result":%s}',c,b?a:JSON.stringify(a));},error:function(g,c,b,d,f){var a=util.format('{"jsonrpc":"2.0","id":%s,"error":{"code":%s,"message":"%s"',g,c,b);
if(d==null){return a+"}}";}else{return util.format('%s,"data":%s}}',a,f?d:JSON.stringify(d));}},parse:function(a){return JSON.parse(String(a));}};var rpc=function(h,j){if(j===undefined){j=true;
if(h instanceof Boolean){j=h;h=null;}}var m,i={},a=0;var g=function(n){n=jsonrpc.parse(n);if("method" in n){k(n);}else{if("result" in n){f(n);}else{if("error" in n){c(n);
}}}};var k=function(o){if(!h){return;}try{var p=function(r,q){if(r){throw"";}if(o.id){m.emit("data",jsonrpc.response(o.id,q)+"\n");}};l(o.method,o.params,p);
}catch(n){if(o.id){m.emit("data",jsonrpc.error(o.id,n.code,n.message,n.data)+"\n");}}};var f=function(n){if(n.id&&i[n.id]){i[n.id](null,n.result);delete i[n.id];
}};var c=function(n){if(n.id&&i[n.id]){var o=new Error(util.format("%s (%s)",n.error.message,n.error.code));o.code=n.error.code;o.data=n.error.data;i[n.id](o);
delete i[n.id];}};var l=function(u,q,v){try{var n=h;var s=u.split(".");while(s.length>1){var o=s.shift();if(n[o]){n=n[o];}else{break;}}var t=n[s[0]];if(t instanceof Function){if(j&&q instanceof Array){q.push(v);
t.apply(null,q);return;}t(q,v);return;}else{throw {code:-32601,message:util.format("Method '%s' not found",u),data:null};}throw"";}catch(r){var p=jsonrpc.errors["-32603"];
throw {code:-32603,message:r?util.format("%s (%s)",p,e.toString()):p,data:null};}};m=through(g);var d=function(n,q,r,p){if(r){i[++a]=r;}var o=jsonrpc.request(n,r?a:null,q,p);
m.emit("data",o+"\n");if(r&&a==Number.MAX_VALUE){a=0;}return m;};var b=function(n,o){if(o===undefined){o=n;n=null;}wrapper={};o.forEach(function(p){wrapper[p]=function(){var r=Array.prototype.slice.call(arguments);
var q=null;if(r[r.length-1] instanceof Function){q=r.pop();}if(n){p=n+"."+p;}d(p,r,q);return this;};});return wrapper;};m.invoke=d;m.wrap=b;return m;};
module.exports=rpc;