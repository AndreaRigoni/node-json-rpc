var util=require("util");var through=require("through");var jsonrpc={errors:{"-32700":"Parse error","-32600":"Invalid Request","-32601":"Method not found","-32602":"Invalid params","-32603":"Internal error","-32000":"Server error"},request:function(e,d,c,b){var a=util.format('{"jsonrpc":"2.0","method":"%s"',e);
if(!d&&!c){return a+"}";}else{if(!c){return util.format('%s,"id":%s',a,d);}else{if(!d){return util.format('%s,"params":%s}',a,b?c:JSON.stringify(c));}else{return util.format('%s,"params":%s,"id":%s}',a,b?c:JSON.stringify(c),d);
}}}},response:function(c,a,b){if(a===undefined){a=null;}return util.format('{"jsonrpc":"2.0","id":%s,"result":%s}',c,b?a:JSON.stringify(a));},error:function(f,c,b,d,e){var a=util.format('{"jsonrpc":"2.0","id":%s,"error":{"code":%s,"message":"%s"',f,c,b);
if(d==null){return a+"}}";}else{return util.format('%s,"data":%s}}',a,e?d:JSON.stringify(d));}},parse:function(a){return JSON.parse(String(a));}};var rpc=function(g,i){if(i===undefined){i=true;
if(g instanceof Boolean){i=g;g=null;}}var l,h={},a=0;var f=function(m){m=jsonrpc.parse(m);if("method" in m){j(m);}else{if("result" in m){e(m);}else{if("error" in m){c(m);
}}}};var j=function(m){if(!g){return;}try{var o=function(q,p){if(q){throw"";}if(m.id){l.emit("data",jsonrpc.response(m.id,p)+"\n");}};k(m.method,m.params,o);
}catch(n){if(m.id){l.emit("data",jsonrpc.error(m.id,n.code,n.message,n.data)+"\n");}}};var e=function(m){if(m.id&&h[m.id]){h[m.id](null,m.result);delete h[m.id];
}};var c=function(m){if(m.id&&h[m.id]){var n=new Error(util.format("%s (%s)",m.error.message,m.error.code));n.code=m.error.code;n.data=m.error.data;h[m.id](n);
delete h[m.id];}};var k=function(n,s,t){try{var m=g;var r=n.split(".");while(r.length>1){var o=r.shift();if(m[o]){m=m[o];}else{break;}}var p=m[r[0]];if(p instanceof Function){if(i&&s instanceof Array){s.push(t);
p.apply(null,s);return;}p(s,t);return;}else{throw {code:-32601,message:util.format("Method '%s' not found",n),data:null};}throw"";}catch(q){throw q||{code:-32603,message:jsonrpc.errors["-32603"],data:null};
}};l=through(f);var d=function(m,p,q,o){if(q){h[++a]=q;}var n=jsonrpc.request(m,q?a:null,p,o);l.emit("data",n+"\n");if(q&&a==Number.MAX_VALUE){a=0;}return l;
};var b=function(m,n){if(n===undefined){n=m;m=null;}wrapper={};n.forEach(function(o){wrapper[o]=function(){var q=Array.prototype.slice.call(arguments);
var p=null;if(q[q.length-1] instanceof Function){p=q.pop();}if(m){o=m+"."+o;}d(o,q,p);return this;};});return wrapper;};l.invoke=d;l.wrap=b;return l;};
module.exports=rpc;